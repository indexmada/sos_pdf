<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="paperformat_custom_paper_format" model="report.paperformat">
            <field name="name">Custom A4</field>
            <field name="default" eval="False"/>
            <field name="disable_shrinking" eval="True"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">5</field>
            <field name="margin_bottom">5</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="dpi">96</field>
        </record>

        <record id="action_invoice_report_custom" model="ir.actions.report">
            <field name="name">Facture client</field>
            <field name="model">account.move</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">sos_pdf.invoice_template</field>
            <field name="report_file">sos_pdf.invoice_template</field>
            <field name="print_report_name">(object._get_report_base_filename())</field>
            <!-- <field name="attachment">(object.state == 'posted') and ((object.name or 'INV').replace('/','_')+'.pdf')</field> -->
            <field name="binding_model_id" ref="model_account_move"/>
            <field name="binding_type">report</field>
            <field name="paperformat_id" ref="paperformat_custom_paper_format"/>
        </record>

        <template id="invoice_template">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="doc">
                    <div class="page" style="font-size: 9pt;">
                        <t t-if="doc.move_type == 'out_invoice'">
                            <!-- Render the invoice content -->
                            <div class="row">
                                <div class="col-auto col-8 mw-100 mb-2" style="width: 48%;">
                                    <div class="row mt-4 mb-4" style="border: 2px solid black; border-radius: 15px; margin-right: 10px; text-align: center;">
                                        <h2 id="invoice_header">FACTURE</h2>
                                    </div>
                                    <div class="row mt-4 mb-4">
                                        <div class="col-auto col-4 mw-50 mb-2">
                                            <div>
                                                <img t-if="doc.company_id.logo" t-att-src="image_data_uri(doc.company_id.logo)" alt="Logo entreprise" style="max-width: 90%;"/>
                                            </div>
                                        </div>
                                        <div class="col-auto col-8 mw-100 mb-2">
                                            <p>
                                                <table style="border: 0;">
                                                    <tr style="line-height: 20px;">
                                                        <td style="border: 0px solid transparent;">Date </td><td style="border: 0px solid transparent;"> : <t t-esc="doc.invoice_date" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/></td>
                                                    </tr>
                                                    <tr style="line-height: 20px;">
                                                        <td style="border: 0px solid transparent;">Numero </td><td style="border: 0px solid transparent; font-size: 11pt;"> : <span style="text-align: left; font-weight: bolder;"><t t-esc="doc.name"/></span></td>
                                                    </tr>
                                                    <tr style="line-height: 20px;">
                                                        <td style="border: 0px solid transparent;">Commande </td>
                                                        <td style="border: 0px solid transparent;">
                                                             : <t t-if="doc.invoice_origin">
                                                                <t t-esc="doc.invoice_origin"/>
                                                            </t>
                                                        </td>
                                                    </tr>
                                                    <tr style="line-height: 20px;">
                                                        <td style="border: 0px solid transparent;">Bon de livraison </td>
                                                        <td style="border: 0px solid transparent;">
                                                             : <t t-if="doc.invoice_origin">
                                                                <t t-esc="doc.get_stock_picking()"/>
                                                            </t>
                                                        </td>
                                                    </tr>
                                                    <tr style="line-height: 20px;">
                                                        <td style="border: 0px solid transparent;">Devis </td>
                                                        <td style="border: 0px solid transparent;">
                                                             : <t t-if="doc.ref">
                                                                <t t-esc="doc.ref"/>
                                                            </t>
                                                            <t t-elif="doc.invoice_origin">
                                                                <t t-esc="doc.invoice_origin"/>
                                                            </t>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto col-4 mw-100 mb-2"
                                    style="border: 2px solid black; border-radius: 15px; padding: 5px; width: 50%;">
                                        <table style="border: 0; width: 100%;">
                                            <tr style="padding-bottom: 20px;">
                                                <td style="border: 0px solid transparent; width: 23%;"><span>Doit : </span></td><td style="border: 0px solid transparent;"><strong style="font-size: 14pt; text-align: center;"><t t-esc="doc.partner_id.name"/></strong></td>
                                            </tr>
                                            <tr>
                                                <td style="border: 0px solid transparent;"><u><strong>NIF :</strong></u></td><td style="border: 0px solid transparent;"><t t-esc="doc.partner_id.nif"/></td>
                                            </tr>
                                            <tr>
                                                <td style="border: 0px solid transparent;"><u><strong>STAT :</strong></u></td><td style="border: 0px solid transparent;"><t t-esc="doc.partner_id.stat"/></td>
                                            </tr>
                                            <tr>
                                                <td style="border: 0px solid transparent;"><u><strong>RC :</strong></u></td><td style="border: 0px solid transparent;"><t t-esc="doc.partner_id.rcs"/></td>
                                            </tr>
                                            <tr>
                                                <td style="border: 0px solid transparent;"><u><strong>CIF :</strong></u></td>
                                                <td style="border: 0px solid transparent;"> 
                                                    <t t-if="doc.partner_id.code_fisc"> 
                                                        <t t-esc="doc.partner_id.code_fisc"/> DU 
                                                        <t t-esc="doc.partner_id.date_code_fisc" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/>
                                                    </t>
                                                </td>
                                            </tr>
                                        </table>
                                        <div style="text-align: center;"> *** ASSUJETI A LA TVA ***</div>
                                        <t t-esc="doc.partner_id.street"/> <t t-esc="doc.partner_id.street2"/><br/><br/>
                                        <t t-esc="doc.partner_id.zip"/> <t t-esc="doc.partner_id.city"/>
                                </div>
                            </div>

                            <div class="row" style="margin-top: 0px; text-align: right; font-size: 7pt;">
                                <div class="col-auto col-8">
                                </div>
                                <div class="col-auto col-2">
                                    <div class="row">
                                        Créé par : 
                                            <t t-if="doc.create_uid">
                                                <strong t-esc="doc.create_uid.name"/>
                                            </t>
                                    </div>
                                </div>
                                <div class="col-auto col-2">
                                    <div class="row">
                                        Le : <strong t-esc="doc.create_date" t-options='{"widget": "datetime", "format": "dd/mm/YY HH:MM:SS"}'/>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 0px; text-align: right; font-size: 7pt;">
                                <div class="col-auto col-8">
                                </div>
                                <div class="col-auto col-2">
                                    <div class="row">
                                        Edité par : 
                                            <t t-if="doc.write_uid">
                                                <strong t-esc="doc.write_uid.name"/>
                                            </t>
                                    </div>
                                </div>
                                <div class="col-auto col-2">
                                    <div class="row">
                                        Le :
                                            <t t-if="doc.write_date">
                                                <strong t-esc="doc.write_date" t-options='{"widget": "datetime", "format": "dd/mm/YY HH:MM:SS"}'/>
                                            </t> 
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row" style="height: 300px;">
                                <table class="table table-borderless" style="border-collapse: collapse; border-bottom: 1px solid black; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th style="border: 1px solid black; padding: 10px;"><strong>Designation</strong></th>
                                            <th style="border: 1px solid black; padding: 10px;"><strong>PU</strong></th>
                                            <th style="border: 1px solid black; padding: 10px;"><strong>QTE</strong></th>
                                            <th style="border: 1px solid black; padding: 10px;"><strong>REM %</strong></th>
                                            <th style="border: 1px solid black; padding: 10px;"><strong>TVA %</strong></th>
                                            <th style="border: 1px solid black; padding: 10px;"><strong>MONTANT TTC</strong></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="doc.invoice_line_ids" t-as="line">
                                            <tr>
                                                <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; border-right: 1px solid black; padding-left: 10px; padding-top: 10px;"><t t-esc="line.name"/></td>
                                                <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; border-right: 1px solid black; text-align: right; padding-right: 10px; padding-top: 10px;"><t t-esc="line.price_unit" t-options='{"widget": "float", "precision": 2}'/></td>
                                                <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; border-right: 1px solid black; text-align: right; padding-right: 10px; padding-top: 10px;"><t t-esc="line.quantity" t-options='{"widget": "float", "precision": 0}'/></td>
                                                <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; border-right: 1px solid black; text-align: center; padding-left: 10px; padding-top: 10px;"><t t-esc="line.discount" t-options='{"widget": "float", "precision": 0}'/></td>
                                                <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; border-right: 1px solid black; text-align: center; padding-left: 10px; padding-top: 10px;"><t t-esc="line.tax_ids[0].amount" t-options='{"widget": "float", "precision": 0}'/></td>
                                                <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; border-right: 1px solid black; text-align: right; padding-right: 10px; padding-top: 10px;"><t t-esc="line.price_subtotal + (line.price_subtotal * (line.tax_ids[0].amount / 100)) + (line.price_subtotal * (line.discount / 100))" t-options='{"widget": "float", "precision": 2}'/></td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>

                            <!-- <div class="col-auto col-12 mw-100 mb-2" style="height: 300px;"> -->
                                <div class="row" style="height: 290px; margin-bottom: 10px;">
                                    <div class="col-auto col-8 mw-100 mb-2" style="border-left: 1px solid black; border-top: 1px solid black; border-bottom: 1px solid black;">
                                        <div class="row" style="border: none;">                                
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td style="padding: 8px;">
                                                        <p><span style="text-decoration: underline; font-style: italic;">OBS.</span> : <span style="text-transform: uppercase;"><t t-esc="doc.narration"/></span></p>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="row" style="border-left: none; border-top: 1px solid black; border-right: none; border-bottom: none;">                                
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td style="padding: 8px;">
                                                        <p>
                                                            <span style="text-decoration: underline; font-style: italic;">Arrêtée à la somme de</span> : 
                                                            <span style="text-align: left; font-weight: bold; font-size: 10pt;">
                                                                <t t-esc="doc.number_to_words()"/> 
                                                                <t t-esc="doc.currency_id.currency_unit_label"/>
                                                            </span>
                                                        </p>
                                                        <p style="margin: 0; margin-top: 20px;"><span style="text-decoration: underline;">Mode de paiement</span> : <t t-esc="doc.get_payment_mode()"/></p>
                                                        <div class="row" style="margin-bottom: 0;">
                                                            <div class="col-auto col-6 mw-100 mb-2">
                                                                <p><span style="text-decoration: underline;">Règlement</span> : <t t-esc="doc.invoice_payment_term_id.name"/></p>
                                                            </div>
                                                            <div class="col-auto col-6 mw-100 mb-2">
                                                                <p><span style="text-decoration: underline;">Echéance</span> : <t t-esc="doc.invoice_date_due" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/></p>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="col-auto col-4 mw-100 mb-2" style="border: 1px solid black;">
                                        <div class="row" style="border: none;">
                                            <table class="table table-borderless" style="text-align: left;">
                                                <t t-set="current_subtotal" t-value="0"/>
                                                <t t-set="current_discount_total" t-value="0"/>
                                                <t t-set="current_net_total" t-value="0"/>
                                                <t t-set="current_tax" t-value="0"/>
                                                <t t-set="inv_lines" t-value="doc.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                                
                                                <t t-foreach="inv_lines" t-as="i_line">
                                                    <!-- <t t-set="current_subtotal" t-value="current_subtotal + i_line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/> -->
                                                    <!-- <t t-set="current_subtotal" t-value="current_subtotal + i_line.price_total" groups="account.group_show_line_subtotals_tax_included"/> -->
                                                    <t t-set="current_subtotal" t-value="current_subtotal + (i_line.price_unit * i_line.quantity)"/>
                                                    <t t-set="current_discount_total" t-value="current_discount_total + ((i_line.price_unit * i_line.quantity) * (i_line.discount / 100))" />
                                                    <t t-set="current_net_total" t-value="current_subtotal - current_discount_total" />
                                                </t>
                                                <t t-set="current_tax" t-value="inv_lines[0].tax_ids[0].amount"/>
                                                    
                                                <tr>
                                                    <th style="padding: 8px;">H.T (non taxable)</th>
                                                    <td style="text-align: right; padding-right: 10px;"><span t-esc="current_subtotal" t-options='{"widget": "float", "precision": 2}'/></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">+ H.T</th>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">- REMISE</th>
                                                    <td style="text-align: right; padding-right: 10px;"><span t-esc="current_discount_total" t-options='{"widget": "float", "precision": 2}'/></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">= NET H.T.</th>
                                                    <td style="text-align: right; padding-right: 10px;"><span t-esc="current_net_total" t-options='{"widget": "float", "precision": 2}'/></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">TVA (<span t-esc="current_tax"/>%)</th>
                                                    <td></td>
                                                </tr>
                                                
                                            </table>
                                        </div>
                                        <div class="row" style="border-top: 1px solid black; border-right: none; border-left: none; border-bottom: none;">
                                            <table class="table table-borderless">
                                                <!--Tax totals-->
                                                <t t-set="tax_totals" t-value="doc.tax_totals"/>
                                                <tr>
                                                    <th style="padding: 8px; text-align: left;">TTC</th>
                                                    <td style="padding: 8px; text-align: right; font-weight: bold; font-size: 14pt;">
                                                        <!-- <span t-esc="tax_totals['formatted_amount_total_rounded']" t-if="'formatted_amount_total_rounded' in tax_totals"/>
                                                        <span t-esc="tax_totals['formatted_amount_total']" t-else=""/> -->
                                                        <t t-esc="doc.amount_total"/> <t t-esc="doc.currency_id.name"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            <!-- </div> -->
                            <div class="row" style="height: 230px;">
                                <div class="col-auto col-12" style="border: 1px solid black;">
                                    <div class="row" style="border: 1px solid black; height: 155px;">
                                        <table class="table table-borderless">
                                            <tr style="page-break-inside: avoid;">
                                                <td style="
                                                    padding: 8px;
                                                    font-family: Arial, sans-serif;
                                                    padding-top: 5px;
                                                    padding-left: 5px;
                                                    padding-bottom: 5px;
                                                    font-weight: bold;
                                                    font-size: 10px;">
                                                    <p>
                                                    Conditions générales : <br/>
                                                    - Toutes les réclamations concernant vos commandes doivent se faire dans les 24h après réception de vos colis. Au-delà de ce délai, elles seront considérées comme irrécouvrables.<br/>
                                                    - Les colis doivent impérativement être retournés dans un délai de 30 jours pour la désinsectisation.<br/>
                                                    - Les articles facturés et livrés restent la propriété de Maexi jusqu'au paiement intégral de la facture.<br/>
                                                    - Toute facture impayée après la date d'échéance entraînera des pénalités.
                                                    </p>
                                                    <p style="
                                                        text-align: center;
                                                        font-size: 11px;
                                                        margin-left: 0px;
                                                        margin-right: 0px;
                                                        margin-bottom: 0px;
                                                        margin-top: 10px;">
                                                        *** !!! Seuls les comptes bancaires et mobile money au nom de MAEXI-TRADING sont validés pour recevoir les paiements. !!! ***
                                                    </p>
                                                    <p style="
                                                        margin: 0;
                                                        font-size: 12px;                             
                                                        text-align: center;">
                                                        MVOLA : 038 65 295 41 - ORANGE MONEY : 233274
                                                    </p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="row" style="border: 1px solid black; height: 70px;">
                                        <table class="table table-borderless">
                                            <tr style="page-break-inside: avoid;">
                                                <td style="padding: 8px;
                                                    font-family: Arial, sans-serif;
                                                    font-size: 6pt;
                                                    padding-top: 5px;
                                                    text-align: center;">
                                                    <p>
                                                    Lot Près IVL 240 Ter - ANOSIVAVAKA - Antananarivo 101 - Bureaux ouverts de 7h 45 à 16h 15 du Lundi au Vendredi<br/>
                                                    TEL : 033 50 344 97/033 50 202 62 - Email : maexi-trading@maexitrading.com <br/>
                                                    RCS : 2003 B00 555 - STAT : 46496 11 2003 01 00 11 - NIF : 300 000 5552 - CIF : 0241275 DGI-K du 03/07/23
                                                    </p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </t>
                        <t t-else="">
                            <p>Ce rapport est uniquement disponible pour les factures clients.</p>
                        </t>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
