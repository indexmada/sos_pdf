<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="paperformat_custom_paper_format" model="report.paperformat">
            <field name="name">Custom A4</field>
            <field name="default" eval="False"/>
            <field name="disable_shrinking" eval="True"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">5</field>
            <field name="margin_bottom">5</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="dpi">96</field>
        </record>

        <record id="action_invoice_report_custom" model="ir.actions.report">
            <field name="name">Facture client</field>
            <field name="model">account.move</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">sos_pdf.invoice_template</field>
            <field name="report_file">sos_pdf.invoice_template</field>
            <field name="print_report_name">(object._get_report_base_filename())</field>
            <!-- <field name="attachment">(object.state == 'posted') and ((object.name or 'INV').replace('/','_')+'.pdf')</field> -->
            <field name="binding_model_id" ref="model_account_move"/>
            <field name="binding_type">report</field>
            <field name="paperformat_id" ref="paperformat_custom_paper_format"/>
        </record>

        <template id="invoice_template">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="doc">
                    <div class="page" style="font-size: 10pt;">
                        <t t-if="doc.move_type == 'out_invoice'">
                            <!-- Render the invoice content -->
                            <div id="greatest_div" class="row" style="height: 200px;">
                                <div id="greater_div" class="col-auto col-8 mw-100 mb-2">
                                    <div id="great_div" class="row mt-4 mb-4" style="border: 2px solid black; border-radius: 15px; margin-right: 10px; text-align: center;">
                                        <h2 id="invoice_header">FACTURE</h2>
                                    </div>
                                    <div class="row mt-4 mb-4">
                                        <div id="simple_div" class="col-auto col-4 mw-50 mb-2">
                                            <div>
                                                <img t-if="doc.company_id.logo" t-att-src="image_data_uri(doc.company_id.logo)" alt="Logo entreprise" style="max-width: 90%;"/>
                                            </div>
                                        </div>
                                        <div id="simple_div" class="col-auto col-8 mw-100 mb-2">
                                            <p>
                                                Date : <t t-esc="doc.invoice_date" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/><br/>
                                                Numero : <span style="padding: 8px; text-align: left; font-weight: bold;"><t t-esc="doc.name"/></span><br/>
                                                Commande : 
                                                    <t t-if="doc.invoice_origin">
                                                        <t t-esc="doc.invoice_origin"/>
                                                    </t>
                                                <br/>
                                                Bon de livraison : 
                                                    <t t-if="doc.invoice_origin">
                                                        <t t-esc="doc.get_stock_picking()"/>
                                                    </t>
                                                <br/>
                                                Devis : 
                                                    <t t-if="doc.ref">
                                                        <t t-esc="doc.ref"/>
                                                    </t>
                                                    <t t-elif="doc.invoice_origin">
                                                        <t t-esc="doc.invoice_origin"/>
                                                    </t>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto col-4 mw-100 mb-2"
                                    style="border: 2px solid black; border-radius: 15px; padding: 5px;">
                                    <p>
                                        Doit : <strong><t t-esc="doc.partner_id.name"/></strong><br/>
                                        NIF : <t t-esc="doc.partner_id.nif"/><br/>
                                        STAT : <t t-esc="doc.partner_id.stat"/><br/>
                                        RC : <t t-esc="doc.partner_id.rcs"/><br/>
                                        CIF : 
                                            <t t-if="doc.partner_id.code_fisc"> 
                                                <t t-esc="doc.partner_id.code_fisc"/> DU 
                                                <t t-esc="doc.partner_id.date_code_fisc" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/>
                                            </t>
                                        <br/>
                                        <p style="text-align: center;"> *** ASSUJETI A LA TVA ***</p>
                                        <t t-esc="doc.partner_id.street"/><br/>
                                        <t t-esc="doc.partner_id.street2"/>
                                    </p>
                                </div>
                            </div>

                            <div class="row" style="margin-top: 0px; text-align: right; max-height: 25px;">
                                <div class="col-auto col-3">
                                </div>
                                <div class="col-auto col-3">
                                </div>
                                <div class="col-auto col-3" style="font-size: 10px;">
                                    <div class="row">
                                        <p>Créé par : 
                                            <t t-if="doc.create_uid">
                                                <t t-esc="doc.create_uid.name"/>
                                            </t>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-auto col-3" style="font-size: 10px;">
                                    <div class="row">
                                        <p>Le : <t t-esc="doc.create_date" t-options='{"widget": "datetime", "format": "dd/mm/YY HH:MM:SS"}'/></p>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 0px; text-align: right; max-height: 25px;">
                                <div class="col-auto col-3">
                                </div>
                                <div class="col-auto col-3">
                                </div>
                                <div class="col-auto col-3" style="font-size: 10px;">
                                    <div class="row">
                                        <p>Edité par : 
                                            <t t-if="doc.write_uid">
                                                <t t-esc="doc.write_uid.name"/>
                                            </t>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-auto col-3" style="font-size: 10px;">
                                    <div class="row">
                                        <p>Le :
                                            <t t-if="doc.write_date">
                                                <t t-esc="doc.write_date" t-options='{"widget": "datetime", "format": "dd/mm/YY HH:MM:SS"}'/>
                                            </t> 
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <table style="border-collapse: collapse; width: 100%; height: 300px;">
                                <thead>
                                    <tr>
                                        <th style="border: 1px solid black; padding: 10px;">Designation</th>
                                        <th style="border: 1px solid black; padding: 10px;">PU</th>
                                        <th style="border: 1px solid black; padding: 10px;">QTE</th>
                                        <th style="border: 1px solid black; padding: 10px;">REM %</th>
                                        <th style="border: 1px solid black; padding: 10px;">TVA %</th>
                                        <th style="border: 1px solid black; padding: 10px;">MONTANT TTC</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="doc.invoice_line_ids" t-as="line">
                                        <tr>
                                            <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; padding-left: 10px; padding-top: 10px;"><t t-esc="line.name"/></td>
                                            <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; padding-left: 10px; padding-top: 10px;"><t t-esc="line.price_unit" t-options='{"widget": "float", "precision": 2}'/></td>
                                            <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; padding-left: 10px; padding-top: 10px;"><t t-esc="line.quantity" t-options='{"widget": "float", "precision": 0}'/></td>
                                            <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; padding-left: 10px; padding-top: 10px;"><t t-esc="line.discount" t-options='{"widget": "float", "precision": 0}'/></td>
                                            <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; padding-left: 10px; padding-top: 10px;"><t t-esc="line.tax_ids[0].amount" t-options='{"widget": "float", "precision": 0}'/></td>
                                            <td style="border-left: 1px solid black; border-top: none;  border-bottom: none; padding-left: 10px; padding-top: 10px;"><t t-esc="line.price_subtotal + (line.price_subtotal * (line.tax_ids[0].amount / 100)) + (line.price_subtotal * (line.discount / 100))" t-options='{"widget": "float", "precision": 2}'/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <!-- <div class="col-auto col-12 mw-100 mb-2" style="height: 300px;"> -->
                                <div class="row" style="max-height: 290px;">
                                    <div class="col-auto col-6 mw-100 mb-2" style="border-left: 1px solid black; border-bottom: 1px solid black;">
                                        <div class="row" style="border: none;">                                
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td style="padding: 8px;">
                                                        <p><span style="text-decoration: underline;">OBS.</span> : <span style="text-transform: uppercase;"><t t-esc="doc.narration"/></span></p>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="row" style="border-left: none; border-top: 1px solid black; border-right: none; border-bottom: none;">                                
                                            <table class="table table-borderless">
                                                <tr>
                                                    <td style="padding: 8px;">
                                                        <p>
                                                            <span style="text-decoration: underline;">Arrêtée à la somme de</span> : 
                                                            <span style="text-align: left; font-weight: bold; font-size: 10pt;">
                                                                <t t-esc="doc.number_to_words()"/> 
                                                                <t t-esc="doc.currency_id.currency_unit_label"/>
                                                            </span>
                                                            <br/>
                                                        </p>
                                                        <p style="margin: 0; margin-top: 10px;"><span style="text-decoration: underline;">Mode de paiement</span> : <t t-esc="doc.get_payment_mode()"/></p>
                                                        <div class="row">
                                                            <div class="col-auto col-6 mw-100 mb-2">
                                                                <p><span style="text-decoration: underline;">Règlement</span> : <t t-esc="doc.invoice_payment_term_id.name"/></p>
                                                            </div>
                                                            <div class="col-auto col-6 mw-100 mb-2">
                                                                <p><span style="text-decoration: underline;">Echéance</span> : <t t-esc="doc.invoice_date_due" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/></p>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="col-auto col-6 mw-100 mb-2" style="border: 1px solid black; border-top: none;">
                                        <div class="row" style="border: none;">
                                            <table class="table table-borderless" style="text-align: left;">
                                                <t t-set="current_subtotal" t-value="0"/>
                                                <t t-set="current_discount_total" t-value="0"/>
                                                <t t-set="current_net_total" t-value="0"/>
                                                <t t-set="current_tax" t-value="0"/>
                                                <t t-set="inv_lines" t-value="doc.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                                
                                                <t t-foreach="inv_lines" t-as="i_line">
                                                    <!-- <t t-set="current_subtotal" t-value="current_subtotal + i_line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/> -->
                                                    <!-- <t t-set="current_subtotal" t-value="current_subtotal + i_line.price_total" groups="account.group_show_line_subtotals_tax_included"/> -->
                                                    <t t-set="current_subtotal" t-value="current_subtotal + (i_line.price_unit * i_line.quantity)"/>
                                                    <t t-set="current_discount_total" t-value="current_discount_total + ((i_line.price_unit * i_line.quantity) * (i_line.discount / 100))" />
                                                    <t t-set="current_net_total" t-value="current_subtotal - current_discount_total" />
                                                </t>
                                                <t t-set="current_tax" t-value="inv_lines[0].tax_ids[0].amount"/>
                                                    
                                                <tr>
                                                    <th style="padding: 8px;">H.T (non taxable)</th>
                                                    <td><span t-esc="current_subtotal" t-options='{"widget": "float", "precision": 2}'/></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">+ H.T</th>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">- REMISE</th>
                                                    <td><span t-esc="current_discount_total" t-options='{"widget": "float", "precision": 2}'/></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">= NET H.T.</th>
                                                    <td><span t-esc="current_net_total" t-options='{"widget": "float", "precision": 2}'/></td>
                                                </tr>
                                                <tr>
                                                    <th style="padding: 8px;">TVA (<span t-esc="current_tax"/>%)</th>
                                                    <td></td>
                                                </tr>
                                                
                                            </table>
                                        </div>
                                        <div class="row" style="border-top: 1px solid black; border-right: none; border-left: none; border-bottom: none;">
                                            <table class="table table-borderless">
                                                <!--Tax totals-->
                                                <t t-set="tax_totals" t-value="doc.tax_totals"/>
                                                <tr>
                                                    <th style="padding: 8px;">TTC</th>
                                                    <td style="padding: 8px; text-align: left; font-weight: bold; font-size: 14pt;">
                                                        <!-- <span t-esc="tax_totals['formatted_amount_total_rounded']" t-if="'formatted_amount_total_rounded' in tax_totals"/>
                                                        <span t-esc="tax_totals['formatted_amount_total']" t-else=""/> -->
                                                        <t t-esc="doc.amount_total"/> <t t-esc="doc.currency_id.name"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            <!-- </div> -->
                            <div class="row" style="max-height: 230px;">
                                <div class="col-auto col-12" style="border: 1px solid black;">
                                    <div class="row" style="border: 1px solid black; height: 155px;">
                                        <table class="table table-borderless">
                                            <tr style="page-break-inside: avoid;">
                                                <td style="
                                                    padding: 8px;
                                                    font-family: Arial, sans-serif;
                                                    padding-top: 5px;
                                                    padding-left: 5px;
                                                    padding-bottom: 5px;
                                                    font-weight: bold;
                                                    font-size: 10px;">
                                                    <p>
                                                    Conditions générales : <br/>
                                                    - Toutes les réclamations concernant vos commandes doivent se faire dans les 24h après réception de vos colis. Au-delà de ce délai, elles seront considérées comme irrécouvrables.<br/>
                                                    - Les colis doivent impérativement être retournés dans un délai de 30 jours pour la désinsectisation.<br/>
                                                    - Les articles facturés et livrés restent la propriété de Maexi jusqu'au paiement intégral de la facture.<br/>
                                                    - Toute facture impayée après la date d'échéance entraînera des pénalités.
                                                    </p>
                                                    <p style="
                                                        text-align: center;
                                                        margin: 10px 0;">
                                                        *** !!! Seuls les comptes bancaires et mobile money au nom de MAEXI-TRADING sont validés pour recevoir les paiements. !!! ***
                                                    </p>
                                                    <p style="                                    
                                                        text-align: center;">
                                                        MVOLA : 038 65 295 41 - ORANGE MONEY : 233274
                                                    </p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="row" style="border: 1px solid black; height: 75px;">
                                        <table class="table table-borderless">
                                            <tr style="page-break-inside: avoid;">
                                                <td style="padding: 8px;
                                                    font-family: Arial, sans-serif;
                                                    font-size: 10px;
                                                    padding-top: 5px;
                                                    text-align: center;">
                                                    <p>
                                                    Lot Près IVL 240 Ter - ANOSYVAHAKA - Antananarivo 101 - Bureaux ouverts de 7h45 à 16h15 du Lundi au Vendredi<br/>
                                                    TEL : 033 57 044 973 / 033 50 202 62 - Email : maexi-trading@maexitrading.com<br/>
                                                    RCS : 2003 B 00556 - STAT : 46496 11 2003 01 00 11 - NIF : 300 000 5552 - CIF : 0241275 DGIK du 03/07/23
                                                    </p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </t>
                        <t t-else="">
                            <p>Ce rapport est uniquement disponible pour les factures clients.</p>
                        </t>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
